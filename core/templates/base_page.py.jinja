"""
Base Page Object with Self-Healing Capabilities
Auto-generated
"""
from playwright.sync_api import Page, TimeoutError

class BasePage:
    """
    Base class for all Page Objects.
    Includes robust interaction methods to handle common UI issues like overlays.
    """
    def __init__(self, page: Page):
        self.page = page

    def do_click(self, locator):
        """
        Robust click with auto-recovery for intercepted clicks (modals/overlays).
        """
        try:
            locator.click(timeout=5000) # Fast fail first
        except TimeoutError as e:
            error_msg = str(e)
            if "intercepts pointer events" in error_msg or "Timeout" in error_msg:
                print(f"⚠️  Click intercepted or timed out. Attempting self-healing...")
                
                # Strategy 1: Press Escape (closes modals)
                self.page.keyboard.press("Escape")
                self.page.wait_for_timeout(500)
                
                # Strategy 2: Click top-left to unfocus/close certain overlays
                # self.page.mouse.click(0, 0)
                
                # Strategy 3: Force click (last resort, but risky if overlay is real)
                # locator.click(force=True) 
                
                # Retry standard click
                try:
                    locator.click(timeout=5000)
                    print("✅  Self-healing successful!")
                except Exception as retry_e:
                    print(f"❌  Self-healing failed: {retry_e}")
                    raise e # Raise original error or new one
            else:
                raise e

    def do_fill(self, locator, value):
        """Robust fill"""
        locator.fill(value)
