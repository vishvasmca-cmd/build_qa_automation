[
    {
        "pattern_name": "Iterative List Regression",
        "description": "Used when the agent needs to verify multiple items in a list without stale element errors.",
        "ideal_code": "items = page.locator('.course-card')\nfor i in range(items.count()):\n    smart_action(page, items.nth(i), 'click')\n    wait_for_stability(page)\n    page.go_back()\n    wait_for_stability(page)"
    },
    {
        "pattern_name": "Recursive Start Guard",
        "description": "Handles cases where a 'Start' button might reappear or lead to a roadmap before the actual content.",
        "ideal_code": "def start_flow():\n    if page.get_by_text('Start').is_visible():\n        smart_action(page, 'page.get_by_text(\"Start\")', 'click')\n        wait_for_stability(page)\n        start_flow() # Recurse if needed\nstart_flow()"
    },
    {
        "pattern_name": "Robust Form Submission",
        "description": "Ensures all form fields are filled and the submission is validated with a screenshot or assertion.",
        "ideal_code": "smart_action(page, 'page.get_by_label(\"Name\")', 'fill', value=\"Test User\")\nsmart_action(page, 'page.get_by_label(\"Email\")', 'fill', value=\"test@example.com\")\nsmart_action(page, 'page.get_by_label(\"Message\")', 'fill', value=\"Automated test message.\")\nsmart_action(page, 'page.get_by_role(\"button\", name=\"Send\")', 'click')\nwait_for_stability(page)\nexpect(page.get_by_text(\"Success\")).to_be_visible()\ntake_screenshot(page, \"form_submitted\")"
    },
    {
        "pattern_name": "Dynamic Registration Flow",
        "description": "Handles sign-up with dynamic data and verifies account creation.",
        "ideal_code": "smart_action(page, 'page.get_by_role(\"link\", name=\"Sign Up\")', 'click')\nwait_for_stability(page)\nsmart_action(page, 'page.get_by_placeholder(\"Username\")', 'fill', value=f\"user_{random.randint(1000, 9999)}\")\nsmart_action(page, 'page.get_by_placeholder(\"Email\")', 'fill', value=f\"test_{random.randint(1000, 9999)}@example.com\")\nsmart_action(page, 'page.get_by_role(\"button\", name=\"Create Account\")', 'click')\nwait_for_stability(page)\n# Verify redirect or success message\npage.wait_for_url(\"**/dashboard\")\ntake_screenshot(page, \"registration_complete\")"
    },
    {
        "pattern_name": "Iframe Interaction",
        "description": "Handles elements inside iframes (e.g., payment forms, embedded widgets) correctly.",
        "ideal_code": "frame = page.frame_locator('iframe[title=\"Payment details\"]').first\nwait_for_stability(page)\n# Use frame.locator() instead of page.locator()\nsmart_action(page, frame.get_by_placeholder(\"Card Number\"), 'fill', value=\"4111 1111 1111 1111\")\nsmart_action(page, frame.get_by_placeholder(\"CVC\"), 'fill', value=\"123\")"
    },
    {
        "pattern_name": "Shadow DOM / Complex Hover",
        "description": "Handles elements inside Shadow DOM or requiring hover to reveal.",
        "ideal_code": "# Playwright handles Shadow DOM automatically with visible locators\nmenu = page.locator('nav-menu-item').filter(has_text=\"Products\")\n# Hover to trigger flyout\nsmart_action(page, menu, 'hover')\nwait_for_stability(page)\n# Click the revealed sub-item\nsub_item = page.get_by_role(\"link\", name=\"Laptops\")\nexpect(sub_item).to_be_visible()\nsmart_action(page, sub_item, 'click')"
    },
    {
        "pattern_name": "Robust Dynamic List",
        "description": "Iterates over dynamic search results safely without stale element errors.",
        "ideal_code": "page.get_by_placeholder(\"Search\").fill(\"Laptop\")\npage.get_by_role(\"button\", name=\"Go\").click()\npage.wait_for_selector('.product-card')\n# Re-query elements inside loop to avoid staleness\nfor i in range(3): # Check first 3 results\n    results = page.locator('.product-card')\n    title = results.nth(i).locator('h3').text_content()\n    print(f\"Found: {title}\")"
    }
]